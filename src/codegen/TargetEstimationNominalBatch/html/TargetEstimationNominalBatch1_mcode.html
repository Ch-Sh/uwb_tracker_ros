<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T2U3">x_out</span> ] = TargetEstimationNominalBatch( <span class="var type1" id="S3T3U6">rangeArray</span>,<span class="var type1" id="S4T4U7">params</span>,<span class="var type1" id="S5T5U8">pos_init</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%UNTITLED Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% model</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line">coder.cstructname(<span class="var type0" id="S4T0U14">params</span>, <span class="string">'TargetEstimationParams'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S7T1U17">initialized</span> <span class="var type1" id="S8T2U18">x</span> <span class="var type1" id="S9T6U19">P</span> <span class="var type0" id="S10T0U20">tailStates</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="mxinfo " id="T1:U8"><span class="var type1" id="S11T1U23">numTail</span>=<span class="mxinfo " id="T1:U10">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="mxinfo " id="T1:U11"><span class="var type1" id="S12T1U27">numStatesTail</span>=<span class="mxinfo " id="T1:U13">3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="mxinfo " id="T1:U14"><span class="var type1" id="S13T1U31">numStates</span>=<span class="mxinfo " id="T1:U16">6</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T7:U17">isempty(<span class="var type0" id="S7T0U37">initialized</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line">    <span class="mxinfo " id="T1:U18"><span class="var type1" id="S7T1U40">initialized</span>=<span class="mxinfo " id="T1:U20">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line">    <span class="mxinfo  sgl" id="T6:U21"><span class="var type1 sgl" id="S9T6U44">P</span>=<span class="mxinfo " id="T6:U23">10*eye(<span class="var type1" id="S13T1U50">numStates</span>+<span class="var type1" id="S11T1U52">numTail</span>*<span class="var type1" id="S12T1U53">numStatesTail</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line">    <span class="mxinfo  sgl" id="T1:U27"><span class="mxinfo  sgl" id="T1:U28"><span class="var type1 sgl" id="S9T6U57">P</span>(<span class="mxinfo " id="T1:U30">3</span>,<span class="mxinfo " id="T1:U31">3</span>)</span>=<span class="mxinfo  sgl" id="T1:U32">0.00*eye(1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line">    <span class="mxinfo  sgl" id="T8:U33"><span class="mxinfo  sgl" id="T8:U34"><span class="var type1 sgl" id="S9T6U68">P</span>(<span class="mxinfo " id="T9:U36"><span class="mxinfo " id="T1:U37">4</span>:<span class="mxinfo " id="T1:U38">6</span></span>,<span class="mxinfo " id="T9:U39"><span class="mxinfo " id="T1:U40">4</span>:<span class="mxinfo " id="T1:U41">6</span></span>)</span>=<span class="mxinfo  sgl" id="T8:U42">zeros(3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line">    <span class="mxinfo  sgl" id="T2:U43"><span class="var type1 sgl" id="S8T2U80">x</span>=<span class="mxinfo " id="T2:U45">[<span class="var type1" id="S5T5U83">pos_init</span>;<span class="mxinfo  sgl" id="T1:U47">0</span>;<span class="mxinfo  sgl" id="T1:U48">0</span>;<span class="mxinfo  sgl" id="T1:U49">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"><span class="mxinfo " id="T1:U50"><span class="var type1" id="S17T1U92">Range1</span>=<span class="mxinfo  sgl" id="T1:U52"><span class="var type1 sgl" id="S3T3U94">rangeArray</span>(<span class="mxinfo " id="T1:U54">1</span>)</span></span>;<span class="mxinfo " id="T1:U55"><span class="var type1" id="S18T1U98">Range2</span>=<span class="mxinfo  sgl" id="T1:U57"><span class="var type1 sgl" id="S3T3U100">rangeArray</span>(<span class="mxinfo " id="T1:U59">2</span>)</span></span>;<span class="mxinfo " id="T1:U60"><span class="var type1" id="S19T1U104">Range3</span>=<span class="mxinfo  sgl" id="T1:U62"><span class="var type1 sgl" id="S3T3U106">rangeArray</span>(<span class="mxinfo " id="T1:U64">3</span>)</span></span>;<span class="mxinfo " id="T1:U65"><span class="var type1" id="S20T1U110">Range4</span>=<span class="mxinfo  sgl" id="T1:U67"><span class="var type1 sgl" id="S3T3U112">rangeArray</span>(<span class="mxinfo " id="T1:U69">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"><span class="mxinfo " id="T1:U70"><span class="var type1" id="S21T1U116">qv_x</span>=<span class="mxinfo " id="T1:U72">0.2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"><span class="mxinfo " id="T1:U73"><span class="var type1" id="S22T1U120">qv_y</span>=<span class="mxinfo " id="T1:U75">0.2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="mxinfo " id="T1:U76"><span class="var type1" id="S23T1U124">qv_z</span>=<span class="mxinfo " id="T1:U78">0.2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo " id="T1:U79"><span class="var type1" id="S24T1U128">qp_x</span>=<span class="mxinfo " id="T1:U81">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"><span class="mxinfo " id="T1:U82"><span class="var type1" id="S25T1U132">qp_y</span>=<span class="mxinfo " id="T1:U84">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"><span class="mxinfo " id="T1:U85"><span class="var type1" id="S26T1U136">qp_z</span>=<span class="mxinfo " id="T1:U87">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"><span class="mxinfo " id="T1:U88"><span class="var type1" id="S27T1U140">dt</span>=<span class="mxinfo " id="T1:U90">1/60</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo " id="T8:U91"><span class="var type1" id="S28T8U146">O</span>=<span class="mxinfo " id="T8:U93">zeros(3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"><span class="mxinfo " id="T8:U94"><span class="var type1" id="S29T8U152">I</span>=<span class="mxinfo " id="T8:U96">eye(3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"><span class="mxinfo " id="T6:U97"><span class="var type1" id="S30T6U158">Fxx</span>=<span class="mxinfo " id="T6:U99">[<span class="var type1" id="S29T8U161">I</span>,<span class="var type1" id="S27T1U163">dt</span>*<span class="var type1" id="S29T8U164">I</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line">    <span class="var type1" id="S28T8U166">O</span>,<span class="var type1" id="S29T8U167">I</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"><span class="mxinfo " id="T6:U105"><span class="var type1" id="S31T6U170">Q_r</span>=<span class="mxinfo " id="T6:U107">diag([<span class="var type1" id="S24T1U175">qp_x</span>,<span class="var type1" id="S25T1U176">qp_y</span>,<span class="var type1" id="S26T1U177">qp_z</span>,<span class="var type1" id="S21T1U178">qv_x</span>,<span class="var type1" id="S22T1U179">qv_y</span>,<span class="var type1" id="S23T1U180">qv_z</span>])</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line"><span class="mxinfo " id="T6:U114"><span class="var type1" id="S33T6U183">Qxx</span>=<span class="mxinfo " id="T6:U116">blkdiag(<span class="var type1" id="S31T6U186">Q_r</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line"><span class="mxinfo " id="T8:U118"><span class="var type1" id="S35T8U189">R_WB</span>=<span class="mxinfo " id="T8:U120">eye(3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line"><span class="mxinfo " id="T10:U121"><span class="var type1" id="S36T10U195">R</span>=<span class="mxinfo " id="T10:U123">eye(4)*0.03</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line"><span class="mxinfo  sgl" id="T11:U124"><span class="var type1 sgl" id="S37T11U203">o</span>=<span class="mxinfo  sgl" id="T11:U126">zeros(3,4)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line"><span class="mxinfo  sgl" id="T11:U127"><span class="var type1 sgl" id="S38T11U210">a</span>=<span class="mxinfo  sgl" id="T11:U129">zeros(3,4)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line"><span class="mxinfo  sgl" id="T11:U130"><span class="var type1 sgl" id="S39T11U217">b</span>=<span class="mxinfo  sgl" id="T11:U132">zeros(3,4)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line"><span class="mxinfo  sgl" id="T5:U133"><span class="mxinfo  sgl" id="T5:U134"><span class="var type1 sgl" id="S37T11U225">o</span>(<span class="mxinfo " id="T12:U136">:</span>,<span class="mxinfo " id="T1:U137">1</span>)</span>=<span class="mxinfo  sgl" id="T5:U138"><span class="var type1" id="S35T8U229">R_WB</span>*<span class="mxinfo  sgl" id="T5:U140"><span class="var type1 sgl" id="S4T4U231">params</span>.m_uwb1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line"><span class="mxinfo  sgl" id="T1:U142"><span class="mxinfo  sgl" id="T1:U143"><span class="var type1 sgl" id="S38T11U236">a</span>(<span class="mxinfo " id="T13:U145">1</span>)</span>=<span class="mxinfo  sgl" id="T1:U146"><span class="var type1 sgl" id="S4T4U239">params</span>.UWB1p0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line"><span class="mxinfo  sgl" id="T1:U148"><span class="mxinfo  sgl" id="T1:U149"><span class="var type1 sgl" id="S39T11U244">b</span>(<span class="mxinfo " id="T13:U151">1</span>)</span>=<span class="mxinfo  sgl" id="T1:U152"><span class="var type1 sgl" id="S4T4U247">params</span>.UWB1p1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line"><span class="mxinfo  sgl" id="T5:U154"><span class="mxinfo  sgl" id="T5:U155"><span class="var type1 sgl" id="S37T11U252">o</span>(<span class="mxinfo " id="T12:U157">:</span>,<span class="mxinfo " id="T1:U158">2</span>)</span>=<span class="mxinfo  sgl" id="T5:U159"><span class="var type1" id="S35T8U256">R_WB</span>*<span class="mxinfo  sgl" id="T5:U161"><span class="var type1 sgl" id="S4T4U258">params</span>.m_uwb2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line"><span class="mxinfo  sgl" id="T1:U163"><span class="mxinfo  sgl" id="T1:U164"><span class="var type1 sgl" id="S38T11U263">a</span>(<span class="mxinfo " id="T13:U166">2</span>)</span>=<span class="mxinfo  sgl" id="T1:U167"><span class="var type1 sgl" id="S4T4U266">params</span>.UWB2p0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line"><span class="mxinfo  sgl" id="T1:U169"><span class="mxinfo  sgl" id="T1:U170"><span class="var type1 sgl" id="S39T11U271">b</span>(<span class="mxinfo " id="T13:U172">2</span>)</span>=<span class="mxinfo  sgl" id="T1:U173"><span class="var type1 sgl" id="S4T4U274">params</span>.UWB2p1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line"><span class="mxinfo  sgl" id="T5:U175"><span class="mxinfo  sgl" id="T5:U176"><span class="var type1 sgl" id="S37T11U279">o</span>(<span class="mxinfo " id="T12:U178">:</span>,<span class="mxinfo " id="T1:U179">3</span>)</span>=<span class="mxinfo  sgl" id="T5:U180"><span class="var type1" id="S35T8U283">R_WB</span>*<span class="mxinfo  sgl" id="T5:U182"><span class="var type1 sgl" id="S4T4U285">params</span>.m_uwb3</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line"><span class="mxinfo  sgl" id="T1:U184"><span class="mxinfo  sgl" id="T1:U185"><span class="var type1 sgl" id="S38T11U290">a</span>(<span class="mxinfo " id="T13:U187">3</span>)</span>=<span class="mxinfo  sgl" id="T1:U188"><span class="var type1 sgl" id="S4T4U293">params</span>.UWB3p0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line"><span class="mxinfo  sgl" id="T1:U190"><span class="mxinfo  sgl" id="T1:U191"><span class="var type1 sgl" id="S39T11U298">b</span>(<span class="mxinfo " id="T13:U193">3</span>)</span>=<span class="mxinfo  sgl" id="T1:U194"><span class="var type1 sgl" id="S4T4U301">params</span>.UWB3p1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line"><span class="mxinfo  sgl" id="T5:U196"><span class="mxinfo  sgl" id="T5:U197"><span class="var type1 sgl" id="S37T11U306">o</span>(<span class="mxinfo " id="T12:U199">:</span>,<span class="mxinfo " id="T13:U200">4</span>)</span>=<span class="mxinfo  sgl" id="T5:U201"><span class="var type1" id="S35T8U310">R_WB</span>*<span class="mxinfo  sgl" id="T5:U203"><span class="var type1 sgl" id="S4T4U312">params</span>.m_uwb4</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line"><span class="mxinfo  sgl" id="T1:U205"><span class="mxinfo  sgl" id="T1:U206"><span class="var type1 sgl" id="S38T11U317">a</span>(<span class="mxinfo " id="T13:U208">4</span>)</span>=<span class="mxinfo  sgl" id="T1:U209"><span class="var type1 sgl" id="S4T4U320">params</span>.UWB4p0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line"><span class="mxinfo  sgl" id="T1:U211"><span class="mxinfo  sgl" id="T1:U212"><span class="var type1 sgl" id="S39T11U325">b</span>(<span class="mxinfo " id="T13:U214">4</span>)</span>=<span class="mxinfo  sgl" id="T1:U215"><span class="var type1 sgl" id="S4T4U328">params</span>.UWB4p1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">% prediction</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line"><span class="mxinfo  sgl" id="T2:U217"><span class="var type1" id="S8T2U332">x</span>=<span class="mxinfo  sgl" id="T2:U219"><span class="var type1" id="S30T6U334">Fxx</span>*<span class="var type1" id="S8T2U335">x</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line"><span class="mxinfo " id="T6:U222"><span class="var type1" id="S40T6U338">F</span>=<span class="mxinfo " id="T6:U224">blkdiag(<span class="var type1" id="S30T6U341">Fxx</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line"><span class="mxinfo " id="T6:U226"><span class="var type1" id="S41T6U344">Q</span>=<span class="mxinfo " id="T6:U228">blkdiag(<span class="var type1" id="S33T6U347">Qxx</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line"><span class="mxinfo  sgl" id="T6:U230"><span class="var type1" id="S9T6U350">P</span>=<span class="mxinfo  sgl" id="T6:U232"><span class="mxinfo  sgl" id="T6:U233"><span class="mxinfo  sgl" id="T6:U234"><span class="var type1" id="S40T6U354">F</span>*<span class="var type1" id="S9T6U355">P</span></span>*<span class="var type1" id="S40T6U357">F</span>'</span>+<span class="var type1" id="S41T6U358">Q</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line"><span class="mxinfo  sgl" id="T2:U239"><span class="var type1 sgl" id="S42T2U361">n</span>=<span class="var type1 sgl" id="S8T2U362">x</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line"><span class="mxinfo  sgl" id="T5:U242"><span class="var type1 sgl" id="S43T5U365">pos</span>=<span class="mxinfo " id="T5:U244"><span class="var type1 sgl" id="S8T2U367">x</span>(1:3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"><span class="mxinfo  sgl" id="T14:U246"><span class="var type1 sgl" id="S44T14U373">InitialRangeArray</span>=<span class="mxinfo " id="T14:U248">[<span class="var type1" id="S17T1U376">Range1</span>;<span class="var type1" id="S18T1U378">Range2</span>;<span class="var type1" id="S19T1U380">Range3</span>;<span class="var type1" id="S20T1U382">Range4</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line"><span class="mxinfo " id="T15:U253"><span class="var type1" id="S45T15U385">H</span>=<span class="mxinfo " id="T15:U255">zeros(4,6)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line"><span class="mxinfo " id="T14:U256"><span class="var type1" id="S46T14U392">h</span>=<span class="mxinfo " id="T14:U258">zeros(4,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line"><span class="mxinfo  sgl" id="T16:U259"><span class="var type1 sgl" id="S47T16U399">K</span>=<span class="mxinfo " id="T15:U261">zeros(4,6)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S48T1U406">iter</span>=<span class="mxinfo " id="T1:U263"><span class="mxinfo " id="T1:U264">1</span>:<span class="mxinfo " id="T1:U265">4</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S49T1U412">cntUWB</span>=<span class="mxinfo " id="T1:U267"><span class="mxinfo " id="T1:U268">1</span>:<span class="mxinfo " id="T1:U269">4</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">%         a=[0;0;0;0];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line"><span class="comment">%         b=[1;1;1;1];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line">        <span class="mxinfo " id="T1:U270"><span class="var type1" id="S50T1U418">h_n</span>=<span class="mxinfo  sgl" id="T1:U272">norm(<span class="mxinfo  sgl" id="T5:U273"><span class="var type1 sgl" id="S43T5U422">pos</span>-<span class="mxinfo " id="T5:U275"><span class="var type1 sgl" id="S37T11U424">o</span>(<span class="mxinfo " id="T12:U277">:</span>,<span class="var type1" id="S49T1U426">cntUWB</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line">        <span class="mxinfo " id="T1:U279"><span class="var type1" id="S52T1U429">htmp</span>=<span class="mxinfo  sgl" id="T1:U281">(<span class="mxinfo  sgl" id="T1:U282"><span class="mxinfo  sgl" id="T1:U283">-<span class="mxinfo  sgl" id="T1:U284"><span class="var type1 sgl" id="S38T11U435">a</span>(<span class="var type1" id="S49T1U436">cntUWB</span>)</span></span>+<span class="var type1" id="S50T1U437">h_n</span></span>)/<span class="mxinfo  sgl" id="T1:U288"><span class="var type1 sgl" id="S39T11U439">b</span>(<span class="var type1" id="S49T1U440">cntUWB</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line">        <span class="comment">%derivatives</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line">        <span class="mxinfo  sgl" id="T1:U291"><span class="var type1" id="S53T1U443">h_to_hn</span>=<span class="mxinfo  sgl" id="T1:U293">1/<span class="mxinfo  sgl" id="T1:U294"><span class="var type1 sgl" id="S39T11U447">b</span>(<span class="var type1" id="S49T1U448">cntUWB</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line">        <span class="mxinfo " id="T9:U297"><span class="var type1" id="S54T9U451">hs_to_x</span>=<span class="mxinfo  sgl" id="T9:U299"><span class="mxinfo  sgl" id="T9:U300">2*<span class="mxinfo " id="T9:U301"><span class="var type1 sgl" id="S43T5U456">pos</span>'</span></span>-<span class="mxinfo  sgl" id="T9:U303">2*<span class="mxinfo " id="T9:U304"><span class="mxinfo " id="T5:U305"><span class="var type1 sgl" id="S37T11U461">o</span>(<span class="mxinfo " id="T12:U307">:</span>,<span class="var type1" id="S49T1U463">cntUWB</span>)</span>'</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line">        <span class="mxinfo  sgl" id="T1:U309"><span class="var type1" id="S55T1U466">hn_to_hs</span>=<span class="mxinfo  sgl" id="T1:U311">1/(<span class="mxinfo  sgl" id="T1:U312">2*<span class="mxinfo  dbl sgl" id="T1:U313"><span class="message warning" id="M1F1C">sqrt(<span class="var type1" id="S50T1U474">h_n</span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line">        <span class="mxinfo " id="T9:U315"><span class="var type1" id="S57T9U477">hn_to_x</span>=<span class="mxinfo  sgl" id="T9:U317"><span class="var type1 sgl" id="S55T1U479">hn_to_hs</span>*<span class="var type1" id="S54T9U480">hs_to_x</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line">        <span class="mxinfo " id="T9:U320"><span class="var type1" id="S58T9U483">h_to_x</span>=<span class="mxinfo  sgl" id="T9:U322"><span class="var type1 sgl" id="S53T1U485">h_to_hn</span>*<span class="var type1" id="S57T9U486">hn_to_x</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line">        <span class="mxinfo  sgl" id="T17:U325"><span class="mxinfo  sgl" id="T17:U326"><span class="var type1 sgl" id="S45T15U490">H</span>(<span class="var type1" id="S49T1U491">cntUWB</span>,<span class="mxinfo " id="T18:U329">:</span>)</span>=<span class="mxinfo " id="T17:U330">[<span class="var type1" id="S58T9U495">h_to_x</span>,<span class="mxinfo  sgl" id="T1:U332">0</span>,<span class="mxinfo  sgl" id="T1:U333">0</span>,<span class="mxinfo  sgl" id="T1:U334">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line">        <span class="mxinfo  sgl" id="T1:U335"><span class="mxinfo  sgl" id="T1:U336"><span class="var type1 sgl" id="S46T14U502">h</span>(<span class="var type1" id="S49T1U503">cntUWB</span>)</span>=<span class="var type1" id="S52T1U504">htmp</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line">    <span class="mxinfo " id="T14:U340"><span class="var type1" id="S59T14U507">z</span>=<span class="var type1 sgl" id="S44T14U508">InitialRangeArray</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line">    <span class="mxinfo  sgl" id="T14:U343"><span class="var type1" id="S60T14U511">res</span>=<span class="mxinfo  sgl" id="T14:U345"><span class="var type1" id="S59T14U513">z</span>-<span class="var type1 sgl" id="S46T14U514">h</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line">    <span class="mxinfo  sgl" id="T10:U348"><span class="var type1" id="S61T10U517">S</span>=<span class="mxinfo  sgl" id="T10:U350"><span class="mxinfo  sgl" id="T10:U351"><span class="mxinfo  sgl" id="T15:U352"><span class="var type1 sgl" id="S45T15U521">H</span>*<span class="var type1" id="S9T6U522">P</span></span>*<span class="mxinfo " id="T19:U355"><span class="var type1 sgl" id="S45T15U524">H</span>'</span></span>+<span class="var type1" id="S36T10U525">R</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">    <span class="mxinfo " id="T16:U358"><span class="var type1 sgl" id="S47T16U528">K</span>=<span class="mxinfo  sgl" id="T19:U360"><span class="mxinfo  sgl" id="T19:U361"><span class="var type1" id="S9T6U531">P</span>*<span class="mxinfo " id="T19:U363"><span class="var type1 sgl" id="S45T15U533">H</span>'</span></span>/<span class="var type1 sgl" id="S61T10U534">S</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line">    <span class="comment">% chi^2 outlier rejection</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line">    <span class="mxinfo " id="T1:U366"><span class="var type1" id="S62T1U537">mahal</span>=<span class="mxinfo  dbl sgl" id="T1:U368"><span class="message warning" id="M2F1C">sqrt(<span class="mxinfo  dbl sgl" id="T1:U369"><span class="mxinfo  dbl sgl" id="T20:U370"><span class="mxinfo " id="T20:U371"><span class="var type1 sgl" id="S60T14U543">res</span>'</span>/<span class="var type1" id="S61T10U544">S</span></span>*<span class="var type1 sgl" id="S60T14U545">res</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T7:U375"><span class="var type1" id="S62T1U549">mahal</span>&lt;<span class="mxinfo  sgl" id="T1:U377">4</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line">        <span class="mxinfo  sgl" id="T2:U378"><span class="var type1" id="S42T2U553">n</span>=<span class="mxinfo  sgl" id="T2:U380"><span class="var type1" id="S8T2U555">x</span>+<span class="mxinfo  sgl" id="T21:U382"><span class="var type1" id="S47T16U557">K</span>*(<span class="mxinfo  sgl" id="T14:U384"><span class="var type1 sgl" id="S60T14U560">res</span>-<span class="mxinfo  sgl" id="T14:U386"><span class="var type1 sgl" id="S45T15U562">H</span>*(<span class="mxinfo  sgl" id="T2:U388"><span class="var type1" id="S8T2U565">x</span>-<span class="var type1 sgl" id="S42T2U566">n</span></span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line">        <span class="mxinfo " id="T1:U391"><span class="var type1" id="S63T1U569">outl</span>=<span class="mxinfo " id="T1:U393">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line">        <span class="mxinfo " id="T1:U394"><span class="var type1" id="S63T1U574">outl</span>=<span class="mxinfo " id="T1:U396">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T7:U397"><span class="var type1" id="S63T1U579">outl</span>==<span class="mxinfo " id="T1:U399">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line">    <span class="comment">% only do update if there was no outlyer</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line">    <span class="mxinfo  sgl" id="T6:U400"><span class="var type1" id="S9T6U583">P</span>=<span class="mxinfo  sgl" id="T6:U402">(<span class="mxinfo  sgl" id="T6:U403">eye(<span class="var type1" id="S13T1U590">numStates</span>+<span class="var type1" id="S11T1U592">numTail</span>*<span class="var type1" id="S12T1U593">numStatesTail</span>)-<span class="mxinfo  sgl" id="T22:U407"><span class="var type1 sgl" id="S47T16U595">K</span>*<span class="var type1 sgl" id="S45T15U596">H</span></span></span>)*<span class="var type1" id="S9T6U597">P</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line"><span class="comment">% copy the new state n after the iterated update into the real state</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line"><span class="mxinfo  sgl" id="T2:U411"><span class="var type1 sgl" id="S8T2U600">x</span>=<span class="var type1 sgl" id="S42T2U601">n</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line"><span class="comment">%% state augmentation</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line"><span class="comment">% find first oldest state</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line"><span class="comment">% copy the state to the output variables</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line"><span class="mxinfo  sgl" id="T2:U414"><span class="var type1 sgl" id="S2T2U604">x_out</span>=<span class="var type1 sgl" id="S8T2U605">x</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line"><span class="mxinfo " id="T6:U417"><span class="var type1" id="S64T6U608">P_pos_out</span>=<span class="var type1" id="S9T6U609">P</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line"></span></span>
</pre>
